\documentclass[12pt,letterpaper,noanswers]{exam}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage[margin=0.9in]{geometry}
\renewcommand{\familydefault}{\sfdefault}
\usepackage{multicol}
\pagestyle{head}
\header{AM 111 Class 15}{}{Approximating integrals, p.\thepage}
\runningheadrule
\headrule
\usepackage{siunitx}
\usepackage{graphicx} % more modern
\usepackage{amsmath} 
\usepackage{amssymb} 
\usepackage{hyperref}
\usepackage{tcolorbox}
\usepackage{enumitem}
\def\mbf{\mathbf}
\newcommand{\vc}[1]{\boldsymbol{#1}}
\def\dsst{\displaystyle}
\DeclareMathOperator*{\argmin}{arg\,min} % thin space, limits underneath in displays


\begin{document}
 \pdfpageheight 11in 
  \pdfpagewidth 8.5in

\noindent 

\section*{Preliminaries}

\begin{itemize}
\itemsep0pt
\item Problem set 06 is due by Friday at 5pm.  Submit extension requests in advance of that time.
\item There is a skill check in the next class.
\item Monday and Wednesday office hours will be held on Zoom next week.  Thursday 1-2pm and 4-6pm office hours will be held on zoom.  (Tuesday 2:30-3:30pm and Thursday 2-3pm will be held in Pierce G11).
\end{itemize}


\noindent\textbf{Big picture}

Today: Approximating $\int_{a}^{b}f(x)dx$.

\vspace{0.2cm}
\hrule
\vspace{0.2cm}

\noindent \textbf{Skill check practice}
\begin{questions}
\item The error from using the trapezoid rule to approximate $\int_a^b f(x)dx$ with a single panel is given by $-\frac{1}{12}h^3f''(c_1)$, where $h$ is the panel size.  What is the error for the composite rule?

% \item A quadrature rule can be written in the form $\sum\limits_{k=1}^n a_k f(x_k)$.

% For the composite midpoint rule on two panels, given by $(b-a)\frac{1}{2}\left(f(a + \frac{b-a}{4})+ f(a + 3\frac{b-a}{4})\right)$, identify $n$ and $a_k, x_k$ for $k=1,...,n$

%Trapezoid rule: $(b-a)\frac{1}{2}(f(a)+f(b)$
%Simpson's rule: 
\item The skill from the Class 11 handout (Skill Check C12).
\end{questions}


\vspace{0.2cm}
\hrule
\vspace{0.2cm}

\noindent \textbf{Skill check solution}
\begin{questions}
\item $-\frac{1}{12}(b-a)h^2f''(c)$.  

Explanation:
For $m$ panels evenly splitting $[a,b]$, this comes from $\sum\limits_{k=1}^m -\frac{1}{12}h^3f''(c_k) = -\frac{1}{12}mh^3f''(c) = -\frac{1}{12}(b-a)h^2f''(c)$ (from the generalized intermediate value theorem and noting $mh = (b-a)$).

In general for error $\alpha h^nf''(c_1)$ on a single panel, the error will be $\alpha (b-a)h^{n-1}f''(c)$ for the composite rule.
% \item There are two points in the calculation so $n = 2$.

% $a_k = \frac{1}{2}(b-a)$ for both points.

% $x_1 = a+(b-a)/4$

% $x_2 = a+3(b-a)/4$.
\item See the past handout.
\end{questions}
\vspace{0.2cm}
\hrule
\vspace{0.2cm}

\noindent \textbf{Teams}
\begin{multicols}{3}
1. Mina, Basil, Johan

2. Nini, Brian, Eli

3. Nicolas, Aidan, Julia K

4. Mack, Benjamin, Robert

5. Alex, RJ, Jessica

6. Caitlin, Nina, Daniyal

7. Cameron, Dani, Emma

8. Eletria, Julia M, Tom

9. Ray, Ivonne, Shang

10.  Sophie, Eric, Alex

11. Jack, Esm√©, Zachary

12. Kevin, Kevin, Marissa

\end{multicols}


\section*{Numerical Integration}
\subsection*{Newton-Cotes formulas}
Many integrals cannot be evaluated analytically.


\begin{tcolorbox}
\begin{itemize}
\itemsep0pt
    \item The trapezoid rule is a closed Newton-Cotes formula: $\int_a^b f(x)dx \approx \frac{1}{2}(f(a)+f(b))(b-a)$.  
    \item The {\bf degree of precision} of a numerical integration method is the greatest integer $k$ for which all polynomials of degree $k$ or less are integrated exactly by the method.

    \end{itemize}
    \end{tcolorbox}
    \begin{tcolorbox}
    \begin{itemize}
    \itemsep0pt
        \item The trapezoid rule has a degree of precision is $1$: ($p(x) = c_1 x + c_0$ will be integrated exactly by the rule).
    \item The error from using the trapezoid rule to approximate $\int_a^b f(x)dx$ is $-\frac{1}{12}(b-a)^3f''(c)$ where $c$ is a point in $[a,b]$.
\end{itemize}
\end{tcolorbox}






%\noindent\textbf{Simpson's rule}
\begin{tcolorbox}
\textbf{Simpson's rule} is generated by using quadratic interpolation on $f$ with interpolation points $x_0 = a, x_1 = \frac{a+b}{2}, x_2 = b$.
\end{tcolorbox}
\begin{enumerate}[resume=classQ]
    \item Let $p_2(x) = y_0L_1(x) + y_1L_2(x)+y_2L_3(x)$ where $x_0 = a, x_1 = (a+b)/2, x_2 = b$ and $y_k = f(x_k)$.  
    
    $\displaystyle\int_a^b p_2(x) = A_0 y_0 + A_1 y_1 + A_2 y_2$.  You can find $A_0, A_1, A_2$ by integrating $L_1, L_2, L_3$.  Instead of integrating, use the integral information in the caption of the figure below to find $A_0, A_1, A_2$.  Note that $h = (b-a)/2$.
\end{enumerate}


    \includegraphics{img/Class12Sauerintegrals.png}
    
    
\vspace{0.5in}

% \begin{enumerate}[resume=classQ]
%     \item The \textbf{method of undetermined coefficients} is another option for finding $A_0, A_1, A_2$.
%     \begin{parts}
%     \item For $f(x)$ a constant, linear, or quadratic polynomial, $\int_a^b f(x)dx = A_0 y_0 + A_1 y_1 + A_2 y_2$ is exact.
    
%     Let $f(x) = 1$.  Use $\int_a^b 1\ dx = A_0  + A_1 + A_2 $ to find an equation for $A_0+A_1+A_2$ in terms of $a$ and $b$.
%     \vspace{1in}
%     \item Repeat this for $f(x) = x$ and $f(x) = x^2$ to generate two more equations in terms of $A_0, A_1, A_2$ and $a,b$.
%     \vspace{2in}
%     \item Write your linear system as a matrix equation.
%     \vfill
%     \end{parts}
    
% The solution to the system is $A_0 = A_2 = \dfrac{b-a}{6}$, $A_1 = 4\dfrac{b-a}{6}$.
% \end{enumerate}
\begin{tcolorbox}
\noindent\textbf{Simpson's rule}

Given a function $f(x) \in C^4[a,b]$, let $h = \dfrac{b-a}{2}$.
\[
          \int_{a}^{b} f(x) \, dx = \frac{h}{3}\left[ f(a)+4f\left(\dfrac{a+b}{2}\right) + f(b) \right]
          - \frac{h^5f^{(iv)}(c)}{90}.\]
\end{tcolorbox}



\begin{enumerate}[resume=classQ]
    \item Show that the degree of precision for Simpson's rule is $3$.
    
    To do this, we need to show that $\int_a^b 1\ dx$, $\int_a^b x\ dx$, $\int_a^b x^2\ dx$, $\int_a^b x^3\ dx$ are all integrated exactly by Simpson's rule.

$\int_a^b 1\ dx$, $\int_a^b x\ dx$, $\int_a^b x^2\ dx$ are integrated exactly.  Show that $\int_a^b x^3\ dx$ is as well.
    \begin{parts}
    \item One way to do this is to shift your integral.  Find $k$ such that $\int_a^b x^3 dx = \int_{-h}^h (x+k)^3 dx$.
    \vspace{1cm}
    
    \item Expanding, $(x+k)^3 = x^3 + q(x)$ where $q(x)$ is a quadratic function.  
    
    $\int_a^b x^3 dx = \int_{-h}^h (x+k)^3 dx = \int_{-h}^h x^3 dx  + \int_{-h}^h q(x) dx$
    
    Provide an argument for why each term of the final expression is zero.
    \vspace{0.8in}
    
    
    
    \end{parts}
    
\end{enumerate}

\subsection*{Composite rules (from Sauer \S 5.2.3)}
\begin{tcolorbox}

\begin{itemize}
\itemsep0pt
    \item For a composite rule for $\displaystyle\int_a^b f(x)dx$, break $[a,b]$ into adjacent subintervals, or \textbf{panels}.
    \item The \textbf{composite Trapezoid rule} is the sum of the Trapezoid rule applied to each panel.
    \item For a function $f\in C^2[a,b]$, choose an evenly spaced grid: $a = x_0<x_1<...<x_{m-1}<x_m = b$ with $h = x_k-x_{k-1} = (b-a)/m$.  \[\displaystyle\int_a^b f(x)dx = \frac{h}{2}\left(y_0 + \sum\limits_{k=2}^{m-1}y_k + y_m \right) - (b-a)\frac{h^2}{12}f''(c),\] where $c$ is between $a$ and $b$.
\end{itemize}
\end{tcolorbox}
\begin{enumerate}[resume=classQ]
    \item In a single panel, the error from the Trapezoid rule is given by $-\frac{1}{12}h^3f''(c_k)$ with $x_{k-1}<c_k<x_k$.
    \begin{parts}
    \item Find an expression for the sum of the error over all $m$ panels (use summation notation).
    
\vspace{0.6in}
\item The generalized intermediate value theorem says that for $f$ continuous on $[a,b]$, $c_k$ points in $[a,b]$, and weights $w_1, ..., w_m>0$, there exists a number $c$ between $a$ and $b$ such that $w_1f(c_1)+...+w_mf(c_m) = (w_1+...+w_m)f(c)$.  Use this theorem to write your expression as $f''(c)$ times a constant.  Write the constant in terms of $m$ and $h$.
\vspace{0.7in}
\item Is the error you found equal to $- (b-a)\frac{h^2}{12}f''(c)$?
%\vspace{1cm}
    \end{parts}
\end{enumerate}

The error in the Trapezoid rule is proportional to $f''$ and to $h^3$.

The error in the composite Trapezoid rule is proportional to $f''$ and to $h^2$.

\begin{enumerate}[resume=classQ]
\item For composite Simpson's rule, let each panel be length $2h$.  Use the grid $a = x_0 < x_1 < ... < x_{2m-1}<x_{2m}$.
\begin{parts}
\item For $a = x_0, b = x_2$, Simpson's rule can be written $\int_a^b f(x)dx \approx \frac{h}{3}(y_0 + 4y_1 + y_2)$.

The composite rule is of the form \[\frac{h}{3}\left[y_0 + A \sum\limits_{k=1}^m y_{2k-1} + B\sum\limits_{k=1}^{m-1}y_{2k} + y_{2m}\right].\]

Find $A$ and $B$.
\vspace{0.7in}
\end{parts}
\end{enumerate}

\subsection*{Open vs closed formulas}
\begin{tcolorbox}
\textbf{Closed} Newton-Cotes formulas use $f(a)$ and $f(b)$ in the approximation.

\textbf{Open} Newton-Cotes formulas avoid values from the ends of the intervals.
\end{tcolorbox}
\begin{enumerate}[resume=classQ]
    \item To approximate $\displaystyle\int_a^b f(x)dx$, let $x_0 = a, x_1 = b$, $h = b-a$.  Set $w = x_0 + h/2$ (the midpoint of the interval).
    \begin{parts}
    \item Find the degree $1$ Taylor expansion of $f(x)$ about the midpoint $w$.  Do this exactly, so include the remainder term (it is $\frac{1}{2}(x-w)^2f''(c_x)$.
    \vspace{0.7in}
    \item Integrate both sides from $a$ to $b$.
    
    Note that $f'(w)$ is a constant.  Use the mean value theorem for integrals to remove $f''(c_x)$ from the integral.
    \vspace{0.7in}
    
    \end{parts}
This generates the \textbf{midpoint rule} for approximating an integral.
\end{enumerate}
\begin{tcolorbox}
The \textbf{composite midpoint rule} is given by \[\int_a^bf(x)dx = h\sum\limits_{i=1}^m f(w_i) + \frac{1}{24}(b-a)h^2 f''(c)\] where $h = (b-a)/m$ and $a<c<b$.  The $w_i$ are midpoints of the $m$ equal subintervals of $[a,b]$.
\end{tcolorbox}
% \fbox{
%     \begin{minipage}{15cm}
%       \subsection*{Midpoint Rule}
%       Given a function $f(x) \in C^2(x_0,x_1)$ and points $x_0<x_1$, $x_1-x_0 = h$,
%             \begin{equation}
%           \int_{x_0}^{x_1} f(x) \, dx = h(f(x_0+ h/2)) + \frac{h^3}{24} f''(c)
%         \end{equation}
%     \end{minipage}}

% \vspace{10cm}


%     \fbox{
%     \begin{minipage}{15cm}
%       \subsection*{Composite Midpoint Rule}
%       Given a function $f(x) \in C^4(a,b)$ and equally spaced
%       points $a=x_0<x_1<\cdots<x_{2m}=b$, $x_{i+1}-x_i = h$,
%       \begin{equation}
%         \int_a^b f(x) \, dx = h \sum_{i=1}^m f\left(\frac{x_{i-1} + x_i}{2}\right) + \frac{(b-a)h^2f''(\xi)}{24}.
%       \end{equation}
%     \end{minipage}}

% \pagebreak

% \subsection*{Adaptive Quadrature}

% \pagebreak

% \been

% \item Read the adaptive quadrature algorithm in the book (\S5.4) and implement it to estimate:

% \beit
% \item $\int_{-1}^1   2\sqrt{1-x^2} dx$
% \item $\int_{-1}^1   1+\sin(e^{3x}) dx$
% \enit

% \enen



%
%\subsection*{Romberg Integration}
%
%\been
%
%\item[4.] Romberg integration uses the composite trapezoid rule with successively
%smaller stepsizes $h$.
%
%\been
%\item {\bf Romberg Integration (First Column)}
%
%Define stepsizes $h_j$ such that each successive stepsize is half the
%previous stepsize:
%\begin{align*}
%h_1 &= b-a \\
%h_2 &= (b-a)/2 \\ 
%h_3 &= (b-a)/4 \\
%& \vdots \\
%h_j&=\frac{1}{2^{j-1}}(b-a).
%\end{align*}
%
%The first column of Romberg integration, $R_{j1}$, is the composite
%trapezoid rule applied to the function on $[a,b]$ with stepsize $h_j$.  Write down the formula for the first few elements of the first column:
%
%\vfill
%
%\begin{align*}
%R_{11} &= \blank{3in} \\
%& \\
%R_{21} &= \blank{3in} \\
%& \\
%R_{31} &= \blank{3in}
%\end{align*}

%\pagebreak
%
%The second column applies Richardson extrapolation to the 1st column
%$R_{j1}$.  Write down the results for the second column.  What is $R_{22}$?
%
%\vfill
%
%\begin{align*}
%R_{22} &= \frac{2^2 R_{21} - R_{11}}{3} = \blank{3in} \\
%& \\
%R_{32} &= \frac{2^2 R_{31} - R_{21}}{3} = \blank{3in}
%\end{align*}
%
%\item Calculate $R_{11}$, $R_{21}$, and $R_{22}$ for $\dsst{\int_0^4 x^2 \, dx}$.
%
%\vfill
%
%\pagebreak
%
%\item The third column applies Richardson extrapolation to the second column.
%Because the second column is composite Simpson's rule, it is 4th order in $h$:
%\begin{align*}
%R_{33} &= \frac{4^2 R_{32} - R_{22}}{4^2-1} \\
%R_{43} &= \frac{4^2 R_{42} - R_{32}}{4^2-1} \\
%& \vdots \\
%R_{j3} &= \frac{4^2 R_{j2} - R_{j-1,2}}{4^2-1}
%\end{align*}
%
%\item This pattern perpetuates
%$$
%R_{jk} = \frac{4^{k-1} R_{j,k-1} - R_{j-1,k-1}}{4^{k-1}-1} 
%$$
%
%\enen
%
%\item[5.] Computer Examples
%\been
%
%\item Estimate $\dsst{\int_{-1}^1 2\sqrt{1-x^2} \, dx}$.
%
%\vspace{1cm}
%
%\item Estimate $\dsst{\int_{-1}^1 1 + \sin{e^{3x}} \, dx}$.
%
%\vspace{1cm}
%
%\enen
%
%\enen


\end{document}